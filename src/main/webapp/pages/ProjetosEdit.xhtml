<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui"
	xmlns:sec="http://www.springframework.org/security/tags">

<ui:composition template="/templates/template.xhtml">

	<ui:define name="content">
	
	<style type="text/css">
		table>thead>tr>th{
			text-align:center !important;
		}
	</style>
		
		<p:toolbar>
			<f:facet name="left">
				<h:panelGrid columns="5">
					<p:spacer width="10px"/>
					<p:graphicImage value="/img/projetos64.png"/>
					<p:spacer width="10px"/>
					<p:outputLabel value="Projetos" />
					<p:commandButton value="Voltar" actionListener="#{projetoBean.redirecionarTela}"
						icon="ui-icon-circle-arrow-w" onclick="PF('load').show()"/>
				</h:panelGrid>
			</f:facet>
		</p:toolbar>
			
		<p:panel id="pnDadosProjetos">
			<div class="ui-grid-row">
				<div class="ui-grid-col-2">
					<h:outputLabel value="Nome do Projeto:" for="nomeProjeto"/>
				</div>
		
				<div class="ui-grid-col-4">
					<p:inputText value="#{projetoBean.projetoSelect.nome}" style="width:87%" id="nomeProjeto"/>
		        </div>
				<div class="ui-grid-col-1">
					<h:outputLabel value="Data Inicial:" for="dataInicial"/>
				</div>
		
				<div class="ui-grid-col-2">
					<p:calendar id="dataInicial"  value="#{projetoBean.projetoSelect.dataInicial}"
	         			showOn="button" locale="pt" pattern="dd/MM/yyyy" mask="true" converter="#{primefacesCalendarConverter}" size="10"
	         			disabled="#{projetoBean.projetoSelect.id != null}"/>
		        </div>
		        
				<div class="ui-grid-col-1">
					<h:outputLabel value="Data Final:" for="dataFinal"/>
				</div>
		
				<div class="ui-grid-col-2">
					<p:calendar id="dataFinal"  value="#{projetoBean.projetoSelect.dataFinalPrevista}"
	         			showOn="button" locale="pt" pattern="dd/MM/yyyy" mask="true" converter="#{primefacesCalendarConverter}" size="10"
	         			disabled="#{projetoBean.projetoSelect.id != null}"/>
		        </div>
	        </div>
	        
	        <div class="ui-grid-row">
				<div class="ui-grid-col-2">
					<h:outputLabel value="Juro/Mês:" for="juroMes"/>
				</div>
		
				<div class="ui-grid-col-2">
					<p:inputText value="#{projetoBean.projetoSelect.juroMes}" style="width:87%" id="juroMes" converter="#{doubleConverter}"
						disabled="#{projetoBean.projetoSelect.id != null}"/>
		        </div>
		        <div class="ui-grid-col-2">
					<h:outputLabel value="Valor Inicial" for="vlrInicial"/>
				</div>
		
				<div class="ui-grid-col-2">
					<p:inputText value="#{projetoBean.projetoSelect.valorInicial}" style="width:80%" id="vlrInicial" converter="#{doubleConverterDinheiro}"
						disabled="#{projetoBean.projetoSelect.id != null}"/>
		        </div>
		        <div class="ui-grid-col-2">
					<h:outputLabel value="Tipo" for="srmTipo"/>
				</div>
		
				<div class="ui-grid-col-2">
					<p:selectOneMenu id="srmTipo" value="#{projetoBean.projetoSelect.creditoDebito}" style="width:80%" disabled="#{projetoBean.projetoSelect.id != null}">
			            <f:selectItems value="#{projetoBean.tipoItem}" />
			        </p:selectOneMenu>
		        </div>
			</div>
	        
	        <div class="ui-grid-row">
	        	<div class="ui-grid-col-2">
	        		<p:commandButton value="Gerar Planilha" actionListener="#{projetoBean.gerarPlanilha}" onclick="PF('load').show()"
		        		rendered="#{projetoBean.projetoSelect.id == null}"
	        			oncomplete="PF('load').hide()" update="pnDadosInvestimento, formGeral" icon="ui-icon-document-b"/>
	        	</div>
	        </div>
		</p:panel>
		<p:panel  id="pnDadosInvestimento" rendered="#{projetoBean.projetoSelect.listDiasCorridosProjeto.size()>0}">
			<p:commandButton value="Salvar" actionListener="#{projetoBean.salvarProjeto}" icon="ui-icon-disk"
				onclick="PF('load').show()" oncomplete="PF('load').hide()" update="formGeral"/>
			
			 <p:dataTable var="diaCorrido" value="#{projetoBean.projetoSelect.listDiasCorridosProjeto}"
			 	id="dtDiaCorrido">
		        <p:column style="width:16px">
		            <p:rowToggler rendered="#{diaCorrido.listOcorrenciasProjeto.size() > 0}" />
		        </p:column>
		        <p:column headerText="Data" style="text-align:right">
		            <h:outputText value="#{calendarToString.obterData(diaCorrido.data)}" />
		        </p:column>
		        <p:column headerText="Juro/Mês" style="text-align:right" width="85">
		            <h:outputText value="#{diaCorrido.juroMes}" converter="#{doubleConverter}"/>
		        </p:column>
		        <p:column headerText="Taxa juro" style="text-align:right">
		            <h:outputText value="#{diaCorrido.taxaJuro}" converter="#{doubleConverter}"/>
		        </p:column>
		        <p:column headerText="Fator diário" style="text-align:right">
		            <h:outputText value="#{diaCorrido.fatorDiario}" converter="#{doubleConverter}"/>
		        </p:column>
		        <p:column headerText="Crédito" style="text-align:right">
		            <h:outputText value="#{diaCorrido.valorCredito}" converter="#{doubleConverterDinheiro}" styleClass="greenTexto"/>
		        </p:column>
		        <p:column headerText="Débito" style="text-align:right">
		            <h:outputText value="#{diaCorrido.valorDebito}" converter="#{doubleConverterDinheiro}" styleClass="redTexto"/>
		        </p:column>
		        <p:column headerText="Saldo" style="text-align:right" >
		            <h:outputText value="#{diaCorrido.valorSaldoTotal}" converter="#{doubleConverterDinheiro}" styleClass="#{diaCorrido.valorSaldoNegativo ?'redTexto':'greenTexto'}"/>
		        </p:column>
		        <p:column style="width:26px">
		        	<p:commandButton icon="ui-icon-plusthick" id="btnAdicionarOcorrencia" onclick="PF('load').show()" update="mdlOcorrencia"
		        		oncomplete="PF('ocorrenciaDialog').show();PF('load').hide()" actionListener="#{projetoBean.limparOcorrencia}"
		        			style="width:26px;height:26px">
			    	 		<f:setPropertyActionListener value="#{diaCorrido}" target="#{projetoBean.diaCorridoSelect}" />
	        		</p:commandButton>
	        		
	        		<p:tooltip id="toolTipsrServicoFornecedor" for="btnAdicionarOcorrencia" 
						value="Inserir ocorrência - #{calendarToString.obterData(diaCorrido.data)}" />
		        </p:column>
		 
		        <p:rowExpansion>
		            <p:panelGrid  columns="2" columnClasses="label,value" style="width:80%">
		               <p:dataTable var="ocorrenciaProjeto" value="#{diaCorrido.listOcorrenciasProjeto}">
		               		<p:column headerText="Tipo" style="text-align:center">
					            <h:outputText value="#{ocorrenciaProjeto.creditoDebito.label}"/>
					        </p:column>
					        <p:column headerText="Valor" style="text-align:right">
					            <h:outputText value="#{ocorrenciaProjeto.valor}" converter="#{doubleConverterDinheiro}"/>
					        </p:column>
					        <p:column headerText="Sócio/Empresa" style="text-align:right">
					            <h:outputText value="#{ocorrenciaProjeto.socioEmpresa.nome}"/>
					        </p:column>
					        <p:column headerText="Data inclusão" style="text-align:center">
					            <h:outputText value="#{calendarToString.obterDataEHora(ocorrenciaProjeto.dataInclusao)}"/>
					        </p:column>
		               </p:dataTable>
		            </p:panelGrid>
		        </p:rowExpansion>
		    </p:dataTable>
		
		</p:panel>
		
		<script >
			$("[id*='vlrInicial']").mask('#.##0,00', {reverse: true});
			$("[id*='vlrOcorrencia']").mask('#.##0,00', {reverse: true});
		</script>
		
		<p:dialog header="Ocorrência" widgetVar="ocorrenciaDialog" id="mdlOcorrencia" modal="true" showEffect="fade" hideEffect="fade" resizable="true"
			width="50%" closable="false">
			
			<div class="ui-grid-row">
			 	<div class="ui-grid-col-2">
			 		<h:outputLabel value="Sócio/Empresa: " for="srmSocioEmpresa"/>
			 	</div>
			 	<div class="ui-grid-col-6">
			 		<p:selectOneMenu id="srmSocioEmpresa" value="#{projetoBean.ocorrenciaSelect.socioEmpresa}" 
						style="width:80%" converter="#{socioEmpresaConverter}">
			            <f:selectItems value="#{socioEmpresaBean.listSocioEmpresaItens}" />
			        </p:selectOneMenu>
			 	</div>
		 	</div>
			
			 <div class="ui-grid-row">
			 	<div class="ui-grid-col-2">
					<h:outputLabel value="Valor: " for="vlrOcorrencia"/>
				</div>
		
				<div class="ui-grid-col-6">
					<p:inputText value="#{projetoBean.ocorrenciaSelect.valor}" style="width:87%" id="vlrOcorrencia" converter="#{doubleConverterDinheiro}"/>
		        </div>
	        </div>
	        <div class="ui-grid-row">
		        <div class="ui-grid-col-2">
					<h:outputLabel value="Tipo" for="srmTipoOcorrencia"/>
				</div>
		
				<div class="ui-grid-col-6">
					<p:selectOneMenu id="srmTipoOcorrencia" value="#{projetoBean.ocorrenciaSelect.creditoDebito}" style="width:80%">
			            <f:selectItems value="#{projetoBean.tipoItem}"/>
			        </p:selectOneMenu>
		        </div>
			</div>
			
			<f:facet name="footer">
				<div class="ui-grid-row">
      					<div class="ui-grid-col-4" style="text-align:right">
						<p:commandButton actionListener="#{projetoBean.adicionarOcorrenciaDiaCorrido}" 
							value="Adicionar" icon="ui-icon-disk" id="btnAdicionarOcorrencia" update="dtDiaCorrido"
							onclick="PF('load').show()" oncomplete="PF('ocorrenciaDialog').hide();PF('load').hide()" >
							<p:confirm header="Confirmação" message="Deseja realmente adicionar essa ocorrência?" icon="ui-icon-alert"/>	
						</p:commandButton>
					</div>
				    <div class="ui-grid-col-4" style="text-align:left">
						<p:commandButton value="Cancelar" onclick="PF('ocorrenciaDialog').hide()"
							id="btnCancelarOcorrencia" icon="ui-icon-close">
						</p:commandButton>
					</div>
				</div>
			</f:facet>
		</p:dialog>

	</ui:define>

</ui:composition>

</html>