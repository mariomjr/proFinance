<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui"
	xmlns:sec="http://www.springframework.org/security/tags">

<ui:composition template="/templates/template.xhtml">

	<ui:define name="content">
		
		<p:toolbar>
			<f:facet name="left">
				<p:spacer width="10px"/>
				<p:graphicImage name="/img/pendencia.png"/>
				<p:spacer width="10px"/>
				<p:outputLabel value="Sócios/Empresas" />
			</f:facet>
		</p:toolbar>
			
		<p:panel id="listagemFornecedor">
			
			<p:commandButton value="Adicionar Fornecedor" icon="ui-icon-plus" update="mdlFornecedorNf" resetValues="true"
					actionListener="#{fornecedorNFBean.limparFornecedorNf}" id="btnAdicionarFornecedorNf" 
					oncomplete="PF('fornecedorNfDialog').show()"/>
					
			<p:commandButton value="Importar Fornecedores ERP" icon="ui-icon-plus" update="dtFornecedorNf" rendered="#{fornecedorNFBean.visualizaImportacao}"
					actionListener="#{fornecedorNFBean.importarFornecedoresErp}" id="btnImportarFornecedorErp" 
					onstart="PF('statusDialog').show()"  oncomplete="PF('statusDialog').hide()"/>
					
			<p:commandButton value="Anexo" icon="ui-icon-plus" id="btnAnexo" update="mdlAnexo" rendered="false"
					onstart="PF('statusDialog').show()"  oncomplete="PF('statusDialog').hide();PF('dialogAnexo').show()"/>
					
			<h:outputLabel value="Fornecedor pendente :" style="margin-left:100px" />
			<p:selectBooleanButton id="fornecedorPendente" value="#{fornecedorNFBean.pendente}" 
   						onLabel="Sim" offLabel="Não" style="width:60px">
						<p:ajax onstart="PF('statusDialog').show()" oncomplete="PF('statusDialog').hide()" update="dtFornecedorNf"
							listener="#{fornecedorNFBean.atualizarLista}"/>
			</p:selectBooleanButton>
			
			<p:spacer height="30px"/>
					
			<p:dataTable var="fornecedorNf" value="#{fornecedorNFBean.lazyModelFornecedorNf}" paginator="true" rows="10" rowKey="#{fornecedorNf.id}"
				paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
				rowsPerPageTemplate="5,10,15" selectionMode="single" id="dtFornecedorNf" lazy="true"
				paginatorPosition="bottom" widgetVar="fornecedorNfTable">

				<p:ajax event="rowSelect" listener="#{fornecedorNFBean.onRowSelect}" onstart="PF('statusDialog').show()"  global="false" 
					update="mdlFornecedorNf" oncomplete="PF('statusDialog').hide();PF('fornecedorNfDialog').show()" process="@this" />

				<p:column headerText="Nome" sortBy="#{fornecedorNf.nome}" filterBy="#{fornecedorNf.nome}">
					<h:outputText value="#{fornecedorNf.nome}" />
				</p:column>
				<p:column headerText="CNPJ" sortBy="#{fornecedorNf.cnpj}" filterBy="#{fornecedorNf.cnpj}">
					<h:outputText value="#{fornecedorNf.cnpj}" />
				</p:column>
				<p:column headerText="UF" sortBy="#{fornecedorNf.UF}" filterBy="#{fornecedorNf.UF}">
					<h:outputText value="#{fornecedorNf.UF}" />
				</p:column>
				<p:column headerText="Cidade" sortBy="#{fornecedorNf.cidade}" filterBy="#{fornecedorNf.cidade}">
					<h:outputText value="#{fornecedorNf.cidade}" />
				</p:column>

			</p:dataTable>
			
			<p:blockUI block="dtFornecedorNf" trigger="dtFornecedorNf">
		        <p:graphicImage name="/img/loading.gif"/>
		    </p:blockUI>
		</p:panel>
		
		<p:dialog header="Fornecedor" widgetVar="fornecedorNfDialog" id="mdlFornecedorNf" modal="true" showEffect="fade" hideEffect="fade" resizable="true"
			width="60%" closable="false">
			
			<p:messages id="messagesMdlFornecedor" showDetail="true" autoUpdate="false" closable="true" />
    	 	
    	 	<p:tabView id="tbViewFornecedor">
    	 		<p:tab title="Dados" id="tabFornecedorDados">
		    	 	<div class="ui-grid-row">
				    	 <div class="ui-grid-col-2"><h:outputLabel for="itCnpjFornecedor" value="CNPJ :" /><h:outputLabel value="*" style="color:red" /></div>
				    	 <div class="ui-grid-col-9">
				    	 	<p:inputText id="itCnpjFornecedor" value="#{fornecedorNFBean.fornecedorNfSelect.cnpj}" style="width:84%"></p:inputText>
				    	 	<p:commandButton icon="ui-icon-search" id="btnBuscarFornecedor" onclick="PF('statusDialog').show()"
				    	 		oncomplete="PF('statusDialog').hide()" actionListener="#{fornecedorNFBean.buscarFornecedor}"
				    	 		update="tbViewFornecedor, messagesMdlFornecedor"/>
			    	 	</div>
		    	 	</div>
		    	 	
		    	 	<div class="ui-grid-row">
				    	 <div class="ui-grid-col-2"><h:outputLabel for="itNomeFornecedor" value="Nome :" /><h:outputLabel value="*" style="color:red" /></div>
				    	 <div class="ui-grid-col-9">
				    	 	<p:inputText id="itNomeFornecedor" value="#{fornecedorNFBean.fornecedorNfSelect.nome}" style="width:97%"></p:inputText>
			    	 	</div>
		    	 	</div>
		    	 	
		    	 	<div class="ui-grid-row">
			    	 	<div class="ui-grid-col-2"><h:outputLabel for="itUf" value="UF :" /><h:outputLabel value="*" style="color:red" /></div>
				    	 <div class="ui-grid-col-9">
				    	 	<p:inputText id="itUf" value="#{fornecedorNFBean.fornecedorNfSelect.UF}" style="width:97%"></p:inputText>
			    	 	</div>
		    	 	</div>
		    	 	
		    	 	<div class="ui-grid-row">
				    	 <div class="ui-grid-col-2"><h:outputLabel for="itCidade" value="Cidade :" /><h:outputLabel value="*" style="color:red" /></div>
				    	 <div class="ui-grid-col-9">
				    	 	<p:inputText id="itCidade" value="#{fornecedorNFBean.fornecedorNfSelect.cidade}" style="width:97%"></p:inputText>
			    	 	</div>
		    	 	</div>
	    	 	</p:tab>

			</p:tabView>
			
			<f:facet name="footer">
				<div class="ui-grid-row">
      					<div class="ui-grid-col-4" style="text-align:right">
						<p:commandButton actionListener="#{fornecedorNFBean.salvarFornecedorNf}" 
							value="Salvar" update="dtFornecedorNf" icon="ui-icon-disk"
							id="btnSalvarFornecedor" process="@form" styleClass="btnSavePrime whiteIcon"
							onclick="PF('statusDialog').show()" oncomplete="PF('statusDialog').hide()" >
							<p:confirm header="Confirmação" message="Deseja realmente salvar esse fornecedor?" icon="ui-icon-alert"/>	
						</p:commandButton>
					</div>
					<div class="ui-grid-col-4" style="text-align:center">
						<p:commandButton value="Remover" actionListener="#{fornecedorNFBean.removerFornecedorNf}"
							id="btnRemoverFornecedor" icon="ui-icon-trash" disabled ="#{fornecedorNFBean.fornecedorNfSelect.id==null?true:false}"
							update="messages,dtFornecedorNf" styleClass="btnCancelPrime whiteIcon" onclick="PF('statusDialog').show()"
							oncomplete="PF('fornecedorNfDialog').hide();PF('statusDialog').hide()" style="margin-left:10px;margin-right:10px">
							<p:confirm header="Confirmação" message="Deseja realmente remover esse fornecedor?" icon="ui-icon-alert"/>
						</p:commandButton>
					</div>
				    <div class="ui-grid-col-4" style="text-align:left">
						<p:commandButton value="Cancelar" onclick="PF('fornecedorNfDialog').hide()"
							id="btnCancelar" icon="ui-icon-close">
							<p:confirm header="Confirmação" message="Deseja realmente cancelar as modificações?" icon="ui-icon-alert"/>
						</p:commandButton>
					</div>
				</div>
			</f:facet>
		</p:dialog>
		
		<script>$("[id*='itCnpjFornecedor']").mask('00.000.000/0000-00', {reverse: true});</script>		


	</ui:define>

</ui:composition>

</html>